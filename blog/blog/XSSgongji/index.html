<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.64">
    <title>XSS攻击 | Vuepress Theme Blue</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-0b99fa56.css" as="style"><link rel="stylesheet" href="/assets/style-0b99fa56.css">
    <link rel="modulepreload" href="/assets/app-a6a5d4a7.js"><link rel="modulepreload" href="/assets/index.html-05b76199.js"><link rel="modulepreload" href="/assets/index.html-f5f5632b.js"><link rel="prefetch" href="/assets/404.html-30afe3c5.js" as="script"><link rel="prefetch" href="/assets/index.html-87180724.js" as="script"><link rel="prefetch" href="/assets/index.html-ed0fd3d1.js" as="script"><link rel="prefetch" href="/assets/index.html-817918d0.js" as="script"><link rel="prefetch" href="/assets/index.html-ab2771d8.js" as="script"><link rel="prefetch" href="/assets/index.html-62bdddc1.js" as="script"><link rel="prefetch" href="/assets/index.html-0aaea317.js" as="script"><link rel="prefetch" href="/assets/index.html-362e5eda.js" as="script"><link rel="prefetch" href="/assets/index.html-22e9a1e5.js" as="script"><link rel="prefetch" href="/assets/index.html-03899184.js" as="script"><link rel="prefetch" href="/assets/index.html-bd04de7d.js" as="script"><link rel="prefetch" href="/assets/index.html-8432d7c2.js" as="script"><link rel="prefetch" href="/assets/index.html-f4bc7919.js" as="script"><link rel="prefetch" href="/assets/index.html-266cfb01.js" as="script"><link rel="prefetch" href="/assets/index.html-b2cc8270.js" as="script"><link rel="prefetch" href="/assets/index.html-98c00800.js" as="script"><link rel="prefetch" href="/assets/index.html-ae33ec0f.js" as="script"><link rel="prefetch" href="/assets/index.html-9f76b2fb.js" as="script"><link rel="prefetch" href="/assets/index.html-a8dc90b6.js" as="script"><link rel="prefetch" href="/assets/index.html-3d3599dc.js" as="script"><link rel="prefetch" href="/assets/index.html-23399167.js" as="script"><link rel="prefetch" href="/assets/index.html-404c3b2e.js" as="script"><link rel="prefetch" href="/assets/index.html-a9560cb8.js" as="script"><link rel="prefetch" href="/assets/index.html-0a493daa.js" as="script"><link rel="prefetch" href="/assets/index.html-cdee76d8.js" as="script"><link rel="prefetch" href="/assets/index.html-0e1d1c06.js" as="script"><link rel="prefetch" href="/assets/index.html-f692a8a6.js" as="script"><link rel="prefetch" href="/assets/index.html-b5f11fde.js" as="script"><link rel="prefetch" href="/assets/index.html-bb530bb0.js" as="script"><link rel="prefetch" href="/assets/index.html-0c076014.js" as="script"><link rel="prefetch" href="/assets/index.html-e965da56.js" as="script"><link rel="prefetch" href="/assets/index.html-d03c30ac.js" as="script"><link rel="prefetch" href="/assets/index.html-3f6e11fd.js" as="script"><link rel="prefetch" href="/assets/index.html-718a010f.js" as="script"><link rel="prefetch" href="/assets/index.html-b53b6fcb.js" as="script"><link rel="prefetch" href="/assets/index.html-023f9a25.js" as="script"><link rel="prefetch" href="/assets/index.html-52791d54.js" as="script"><link rel="prefetch" href="/assets/index.html-782e61bb.js" as="script"><link rel="prefetch" href="/assets/index.html-98c2c35b.js" as="script"><link rel="prefetch" href="/assets/index.html-fabfc81c.js" as="script"><link rel="prefetch" href="/assets/index.html-8fb78894.js" as="script"><link rel="prefetch" href="/assets/index.html-620675de.js" as="script"><link rel="prefetch" href="/assets/index.html-b7cf35a2.js" as="script"><link rel="prefetch" href="/assets/index.html-e14ec4b7.js" as="script"><link rel="prefetch" href="/assets/index.html-d9618c98.js" as="script"><link rel="prefetch" href="/assets/index.html-295b3ade.js" as="script"><link rel="prefetch" href="/assets/index.html-3da56c89.js" as="script"><link rel="prefetch" href="/assets/index.html-ea362abf.js" as="script"><link rel="prefetch" href="/assets/index.html-df93660b.js" as="script"><link rel="prefetch" href="/assets/index.html-164449d6.js" as="script"><link rel="prefetch" href="/assets/index.html-4b594f0f.js" as="script"><link rel="prefetch" href="/assets/index.html-3ff531d7.js" as="script"><link rel="prefetch" href="/assets/404.html-99967f39.js" as="script"><link rel="prefetch" href="/assets/index.html-02bedc7d.js" as="script"><link rel="prefetch" href="/assets/index.html-32ba965a.js" as="script"><link rel="prefetch" href="/assets/index.html-8d2845c0.js" as="script"><link rel="prefetch" href="/assets/index.html-7e3b40a2.js" as="script"><link rel="prefetch" href="/assets/index.html-5e14943c.js" as="script"><link rel="prefetch" href="/assets/index.html-8ddd90f6.js" as="script"><link rel="prefetch" href="/assets/index.html-199bc0b0.js" as="script"><link rel="prefetch" href="/assets/index.html-f8b17ccb.js" as="script"><link rel="prefetch" href="/assets/index.html-1ff18482.js" as="script"><link rel="prefetch" href="/assets/index.html-731a621f.js" as="script"><link rel="prefetch" href="/assets/index.html-cb2cf034.js" as="script"><link rel="prefetch" href="/assets/index.html-ffdd0bf6.js" as="script"><link rel="prefetch" href="/assets/index.html-42d4917e.js" as="script"><link rel="prefetch" href="/assets/index.html-9a0a97b3.js" as="script"><link rel="prefetch" href="/assets/index.html-81eaf5de.js" as="script"><link rel="prefetch" href="/assets/index.html-ebb9ee77.js" as="script"><link rel="prefetch" href="/assets/index.html-23c0d38b.js" as="script"><link rel="prefetch" href="/assets/index.html-816f6ec1.js" as="script"><link rel="prefetch" href="/assets/index.html-e9073f0e.js" as="script"><link rel="prefetch" href="/assets/index.html-e96cc586.js" as="script"><link rel="prefetch" href="/assets/index.html-a6758ea4.js" as="script"><link rel="prefetch" href="/assets/index.html-8cc81fbf.js" as="script"><link rel="prefetch" href="/assets/index.html-d3d05473.js" as="script"><link rel="prefetch" href="/assets/index.html-6170b0bf.js" as="script"><link rel="prefetch" href="/assets/index.html-30911cd4.js" as="script"><link rel="prefetch" href="/assets/index.html-33b21e52.js" as="script"><link rel="prefetch" href="/assets/index.html-5e65c1b9.js" as="script"><link rel="prefetch" href="/assets/index.html-2a164f81.js" as="script"><link rel="prefetch" href="/assets/index.html-2147f896.js" as="script"><link rel="prefetch" href="/assets/index.html-11385ea4.js" as="script"><link rel="prefetch" href="/assets/index.html-e02a98c4.js" as="script"><link rel="prefetch" href="/assets/index.html-e7298fb0.js" as="script"><link rel="prefetch" href="/assets/index.html-ef1df29b.js" as="script"><link rel="prefetch" href="/assets/index.html-82ec9c97.js" as="script"><link rel="prefetch" href="/assets/index.html-51dc7c9c.js" as="script"><link rel="prefetch" href="/assets/index.html-f8e6c09a.js" as="script"><link rel="prefetch" href="/assets/index.html-d7237f1b.js" as="script"><link rel="prefetch" href="/assets/index.html-264956b9.js" as="script"><link rel="prefetch" href="/assets/index.html-c0aca1d1.js" as="script"><link rel="prefetch" href="/assets/index.html-77117f6a.js" as="script"><link rel="prefetch" href="/assets/index.html-ece5da38.js" as="script"><link rel="prefetch" href="/assets/index.html-00db6cca.js" as="script"><link rel="prefetch" href="/assets/index.html-fd95335e.js" as="script"><link rel="prefetch" href="/assets/index.html-14649045.js" as="script"><link rel="prefetch" href="/assets/index.html-6546a4e6.js" as="script"><link rel="prefetch" href="/assets/index.html-9b4e410e.js" as="script"><link rel="prefetch" href="/assets/index.html-9aa4d534.js" as="script"><link rel="prefetch" href="/assets/index.html-66c19831.js" as="script"><link rel="prefetch" href="/assets/index.html-3caeb87d.js" as="script"><link rel="prefetch" href="/assets/index.html-9d0d9115.js" as="script"><link rel="prefetch" href="/assets/index.html-ad57ae51.js" as="script"><link rel="prefetch" href="/assets/giscus-2a044aea-497f0bd4.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><div class="nav" data-v-a231a75e data-v-ad3cbd41><div class="container" data-v-ad3cbd41><!--[--><a href="/" class="nav-action-wrapper" data-v-ad3cbd41><div class="nav-action" data-v-ad3cbd41>首页</div></a><a href="/category" class="nav-action-wrapper" data-v-ad3cbd41><div class="nav-action" data-v-ad3cbd41>分类</div></a><!--]--></div></div><div class="container" data-v-a231a75e><!--[--><div class="blog-page" data-v-dd29a953><div class="card blog" data-v-dd29a953 data-v-2e70653c><!--[--><!----><h1 class="title" data-v-dd29a953>XSS攻击</h1><div class="markdown-body content" data-v-dd29a953><h3 id="_1-前言" tabindex="-1"><a class="header-anchor" href="#_1-前言" aria-hidden="true">#</a> 1. 前言</h3><p>XSS全称 Cross Site Scripting，跨站脚本漏洞，通过执行恶意脚本，以实现窃取用户登录态、劫持会话等目的的攻击方式。恶意脚本的输入源有：Cookie、Post表的、Get请求、HTTP头内容等，通常将一段 XSS 攻击的代码称为<strong>XSS向量</strong>。主要原因是没有针对用户输入的数据进行检查、过滤。</p><h3 id="_2-xss类型" tabindex="-1"><a class="header-anchor" href="#_2-xss类型" aria-hidden="true">#</a> 2. XSS类型</h3><ul><li><strong>放射性XSS</strong>：直接将 XSS 向量拼接在 URL 中，诱导用户点击，链接中所携带的参数会回显于页面中或者作为页面的处理数据源，最终造成XSS攻击</li><li><strong>存储型XSS</strong>：通过表单，将 XSS 向量提交到数据库。当页面展示数据时，执行 XSS 向量</li><li>**DOM Based XSS：**通过修改浏览页面的 DOM ，绕过防御规则，执行恶意脚本，达到攻击目的</li></ul><h3 id="_3-xss防范手段" tabindex="-1"><a class="header-anchor" href="#_3-xss防范手段" aria-hidden="true">#</a> 3. XSS防范手段</h3><ul><li><p>前、后端穷举有限标签和属性，进行白名单过滤</p><ul><li>说明：前端要求用户仅能输入指定、有限的标签和属性。前端可以通过富文本编辑器配置仅显示指定标签，提升用户体验。后端不能信任前端数据，需要基于白名单再次过滤，保证入库的数据都是可信任的</li><li>适用场景：简单富文本输入</li></ul></li><li><p>后端转移存储，前端展示时，进行黑名单过滤</p><ul><li>说明：实际上普通用户不会输入 XSS 向量，而攻击者可以很轻松地直接发起API请求，所以前端不进行数据检查，后端完全不信任数据输入，直接将用户输入的数据转义入库，然后反转义输出，保证数据库中的内容是可信任的。展示数据时，前端对展示的内容进行基于黑名单的过滤</li><li>使用场景：对输入标签范围不定，富文本编辑功能复杂</li></ul></li></ul><h3 id="_4-cookie-httponly" tabindex="-1"><a class="header-anchor" href="#_4-cookie-httponly" aria-hidden="true">#</a> 4. Cookie HttpOnly</h3><p>大部分攻击者会想要获取到用户的cookie，所以我们需要在 http 的响应头 set-cookie 时设置 httponly，让浏览器知道不能通过document.cookie的方式获取到cookie内容</p><h3 id="_5-设置csp" tabindex="-1"><a class="header-anchor" href="#_5-设置csp" aria-hidden="true">#</a> 5. 设置CSP</h3><p>CSP (Content Security Policy) 是用来防御 XSS 的安全策略</p><p>CSP 通过白名单控制，仅允许加载指定的资源，包括 JavaScript、CSS、HTML、image、、video、Frames等</p><h4 id="设置csp的方式" tabindex="-1"><a class="header-anchor" href="#设置csp的方式" aria-hidden="true">#</a> 设置CSP的方式</h4><ul><li>设置 HTTP 头信息的 <code>Content-Security-Policy</code> 字段</li><li>在网页添加 <code>&lt;meta&gt;</code> 标签</li></ul><h4 id="指令及说明" tabindex="-1"><a class="header-anchor" href="#指令及说明" aria-hidden="true">#</a> 指令及说明</h4><ul><li><code>default-src</code>：定义资源默认加载策略</li><li><code>connect-src</code>：定义 Ajax、WebSocket 等加载策略</li><li><code>font-src</code>：定义 Font 加载策略</li><li><code>frame-src</code>：定义 Frame 加载策略</li><li><code>img-src</code>：定义图片加载策略</li><li><code>media-src</code>：定义 audio、video等引用资源加载策略</li><li><code>object-src</code>：定义 applet、embed、object 等引用资源加载策略</li><li><code>script-src</code>： 定义 JS 加载策略</li><li><code>style-src</code>：定义CSS 加载策略</li></ul><h4 id="配置csp" tabindex="-1"><a class="header-anchor" href="#配置csp" aria-hidden="true">#</a> 配置CSP</h4><ul><li><p>只允许同源资源</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Content-Security-Policy: default-src <span class="token string">&#39;self&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>允许同源以及指定地址的 JS 资源</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Content-Security-Policy: script-src <span class="token string">&#39;self&#39;</span> www.google-analytics.com ajax.googleapis.com<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>多个资源时，后面的会覆盖前面的</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Content-Security-Policy: default-src <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span> script-src <span class="token string">&#39;self&#39;</span><span class="token punctuation">;</span> connect-src <span class="token string">&#39;self&#39;</span><span class="token punctuation">;</span> img-src <span class="token string">&#39;self&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>或者使用 meta</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&lt;</span>meta http-equiv<span class="token operator">=</span><span class="token string">&quot;Content-Security-Policy&quot;</span> <span class="token assign-left variable">content</span><span class="token operator">=</span>
    <span class="token string">&quot;script-src &#39;self&#39; *.qq.com *.cdn-go.cn; 
    img-src &#39;self&#39; *.cdn-go.cn *.gtimg.cn data:;
    style-src &#39;unsafe-inline&#39; *.cdn-go.cn; 
    media-src &#39;none&#39;; 
    child-src *.qq.com&quot;</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><p><a href="https://segmentfault.com/a/1190000022678120" target="_blank" rel="noopener noreferrer">前端安全之防范XSS实战小结</a></p><p><a href="https://www.chenshaowen.com/blog/how-to-prevent-xss-in-web-rich-text.html" target="_blank" rel="noopener noreferrer">如何预防 Web 富文本中的 XSS 攻击</a></p></div><!----><!--]--></div><div class="card catalog" data-v-dd29a953 data-v-280e4acd data-v-2e70653c><!--[--><div class="catalog-header" data-v-280e4acd>目录</div><div style="margin-top:5px;margin-bottom:5px;" class="line" data-v-280e4acd data-v-901d8423></div><div class="catalog-content" data-v-280e4acd><!--[--><div class="catalog-item-wrapper" data-v-280e4acd><!--[--><div class="catalog-item" data-v-3d6f5fbb><a class="catalog-item-link" style="opacity:1;font-weight:600;" href="#_1-前言" data-v-3d6f5fbb><div class="vue-ellipsis" data-v-3d6f5fbb><div class="vue-ellipsis-js"><span class="vue-ellipsis-js-content"></span><span class="vue-ellipsis-js-ellipsis"><!--[--><!--[-->...<!--]--><!--[--><!--]--><!--]--></span></div></div></a></div><!----><!--]--><div style="margin-top:5px;margin-bottom:5px;" class="line" data-v-280e4acd data-v-901d8423></div></div><div class="catalog-item-wrapper" data-v-280e4acd><!--[--><div class="catalog-item" data-v-3d6f5fbb><a class="catalog-item-link" style="opacity:1;font-weight:600;" href="#_2-xss类型" data-v-3d6f5fbb><div class="vue-ellipsis" data-v-3d6f5fbb><div class="vue-ellipsis-js"><span class="vue-ellipsis-js-content"></span><span class="vue-ellipsis-js-ellipsis"><!--[--><!--[-->...<!--]--><!--[--><!--]--><!--]--></span></div></div></a></div><!----><!--]--><div style="margin-top:5px;margin-bottom:5px;" class="line" data-v-280e4acd data-v-901d8423></div></div><div class="catalog-item-wrapper" data-v-280e4acd><!--[--><div class="catalog-item" data-v-3d6f5fbb><a class="catalog-item-link" style="opacity:1;font-weight:600;" href="#_3-xss防范手段" data-v-3d6f5fbb><div class="vue-ellipsis" data-v-3d6f5fbb><div class="vue-ellipsis-js"><span class="vue-ellipsis-js-content"></span><span class="vue-ellipsis-js-ellipsis"><!--[--><!--[-->...<!--]--><!--[--><!--]--><!--]--></span></div></div></a></div><!----><!--]--><div style="margin-top:5px;margin-bottom:5px;" class="line" data-v-280e4acd data-v-901d8423></div></div><div class="catalog-item-wrapper" data-v-280e4acd><!--[--><div class="catalog-item" data-v-3d6f5fbb><a class="catalog-item-link" style="opacity:1;font-weight:600;" href="#_4-cookie-httponly" data-v-3d6f5fbb><div class="vue-ellipsis" data-v-3d6f5fbb><div class="vue-ellipsis-js"><span class="vue-ellipsis-js-content"></span><span class="vue-ellipsis-js-ellipsis"><!--[--><!--[-->...<!--]--><!--[--><!--]--><!--]--></span></div></div></a></div><!----><!--]--><div style="margin-top:5px;margin-bottom:5px;" class="line" data-v-280e4acd data-v-901d8423></div></div><div class="catalog-item-wrapper" data-v-280e4acd><!--[--><div class="catalog-item" data-v-3d6f5fbb><a class="catalog-item-link" style="opacity:1;font-weight:600;" href="#_5-设置csp" data-v-3d6f5fbb><div class="vue-ellipsis" data-v-3d6f5fbb><div class="vue-ellipsis-js"><span class="vue-ellipsis-js-content"></span><span class="vue-ellipsis-js-ellipsis"><!--[--><!--[-->...<!--]--><!--[--><!--]--><!--]--></span></div></div></a></div><!----><!--]--><!----></div><!--]--></div><!--]--></div></div><!--]--></div><div class="footer" data-v-a231a75e data-v-21eb7198><section class="footer-section" data-v-21eb7198>©2023 Mittacy. All rights reserved</section><!--[--><section class="footer-section" data-v-21eb7198><span data-v-21eb7198>备案号: 粤ICP备2021130319号-1</span></section><section class="footer-section" data-v-21eb7198><a href="https://beian.miit.gov.cn" target="_blank" rel="noopener noreferrer" data-v-21eb7198></a></section><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-a6a5d4a7.js" defer></script>
  </body>
</html>
