<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <meta name="description" content="醉后不知天在水, 满船清梦压星河">
    <link rel="icon" href="/favicon.ico">
    <title>ES基础</title>
  <link rel="preload" href="/blog/static/js/chunk-vendors.98aa2d5e.js" as="script"><link rel="preload" href="/blog/static/css/app.2a02c875.css" as="style"><link rel="preload" href="/blog/static/js/app.0d2651de.js" as="script"><link rel="preload" href="/blog/static/css/chunk-4b00a56a.e2e22ac3.css" as="style"><link rel="preload" href="/blog/static/js/chunk-4b00a56a.f60616c1.js" as="script"><link rel="preload" href="/blog/static/css/chunk-d54686c8.30e0cc7d.css" as="style"><link rel="preload" href="/blog/static/js/chunk-d54686c8.5143f685.js" as="script"><link rel="prefetch" href="/blog/static/css/chunk-2e3fbe22.a53d4fc3.css"><link rel="prefetch" href="/blog/static/css/chunk-3a5a13a3.2a512b60.css"><link rel="prefetch" href="/blog/static/css/chunk-52bf6e4f.2a374e40.css"><link rel="prefetch" href="/blog/static/css/chunk-b31288f6.c0879475.css"><link rel="prefetch" href="/blog/static/js/chunk-2e3fbe22.ff12df6f.js"><link rel="prefetch" href="/blog/static/js/chunk-3a5a13a3.0cebf565.js"><link rel="prefetch" href="/blog/static/js/chunk-52bf6e4f.1a087b42.js"><link rel="prefetch" href="/blog/static/js/chunk-b31288f6.bfb70cd4.js"><link rel="stylesheet" href="/blog/static/css/app.2a02c875.css"><link rel="stylesheet" href="/blog/static/css/chunk-4b00a56a.e2e22ac3.css"><link rel="stylesheet" href="/blog/static/css/chunk-d54686c8.30e0cc7d.css"><style data-vue-ssr-id="7a22e877:0">.ellipsis {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
html body {
  margin: 0;
  color: #333;
  background-color: #f8f8f8;
}
a {
  text-decoration: none;
  color: #333;
  transition: color 0.3s;
}
a:hover {
  color: #ef4b50;
}
p {
  margin: 0;
}
.markdown-body img {
  margin-top: 10px;
  margin-bottom: 10px;
  box-shadow: 1px 1px 25px #c0c0c0;
}
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s;
}
.fade-enter,
.fade-leave-to {
  opacity: 0;
}
</style><style data-vue-ssr-id="015e92e1:0">/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection, code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
</style><style data-vue-ssr-id="138fb736:0">.markdown-body .octicon {
  display: inline-block;
  fill: currentColor;
  vertical-align: text-bottom;
}

.markdown-body .anchor {
  float: left;
  line-height: 1;
  margin-left: -20px;
  padding-right: 4px;
}

.markdown-body .anchor:focus {
  outline: none;
}

.markdown-body h1 .octicon-link,
.markdown-body h2 .octicon-link,
.markdown-body h3 .octicon-link,
.markdown-body h4 .octicon-link,
.markdown-body h5 .octicon-link,
.markdown-body h6 .octicon-link {
  color: #1b1f23;
  vertical-align: middle;
  visibility: hidden;
}

.markdown-body h1:hover .anchor,
.markdown-body h2:hover .anchor,
.markdown-body h3:hover .anchor,
.markdown-body h4:hover .anchor,
.markdown-body h5:hover .anchor,
.markdown-body h6:hover .anchor {
  text-decoration: none;
}

.markdown-body h1:hover .anchor .octicon-link,
.markdown-body h2:hover .anchor .octicon-link,
.markdown-body h3:hover .anchor .octicon-link,
.markdown-body h4:hover .anchor .octicon-link,
.markdown-body h5:hover .anchor .octicon-link,
.markdown-body h6:hover .anchor .octicon-link {
  visibility: visible;
}

.markdown-body h1:hover .anchor .octicon-link:before,
.markdown-body h2:hover .anchor .octicon-link:before,
.markdown-body h3:hover .anchor .octicon-link:before,
.markdown-body h4:hover .anchor .octicon-link:before,
.markdown-body h5:hover .anchor .octicon-link:before,
.markdown-body h6:hover .anchor .octicon-link:before {
  width: 16px;
  height: 16px;
  content: ' ';
  display: inline-block;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' version='1.1' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'%3E%3C/path%3E%3C/svg%3E");
}.markdown-body {
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  line-height: 1.5;
  color: #24292e;
  font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word;
}

.markdown-body details {
  display: block;
}

.markdown-body summary {
  display: list-item;
}

.markdown-body a {
  background-color: initial;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline-width: 0;
}

.markdown-body strong {
  font-weight: inherit;
  font-weight: bolder;
}

.markdown-body h1 {
  font-size: 2em;
  margin: .67em 0;
}

.markdown-body img {
  border-style: none;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre {
  font-family: monospace,monospace;
  font-size: 1em;
}

.markdown-body hr {
  box-sizing: initial;
  height: 0;
  overflow: visible;
}

.markdown-body input {
  font: inherit;
  margin: 0;
}

.markdown-body input {
  overflow: visible;
}

.markdown-body [type=checkbox] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body * {
  box-sizing: border-box;
}

.markdown-body input {
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
}

.markdown-body a {
  color: #0366d6;
  text-decoration: none;
}

.markdown-body a:hover {
  text-decoration: underline;
}

.markdown-body strong {
  font-weight: 600;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #dfe2e5;
}

.markdown-body hr:after,
.markdown-body hr:before {
  display: table;
  content: "";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body table {
  border-spacing: 0;
  border-collapse: collapse;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body details summary {
  cursor: pointer;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
  line-height: 10px;
  color: #444d56;
  vertical-align: middle;
  background-color: #fafbfc;
  border: 1px solid #d1d5da;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #d1d5da;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body h1 {
  font-size: 32px;
}

.markdown-body h1,
.markdown-body h2 {
  font-weight: 600;
}

.markdown-body h2 {
  font-size: 24px;
}

.markdown-body h3 {
  font-size: 20px;
}

.markdown-body h3,
.markdown-body h4 {
  font-weight: 600;
}

.markdown-body h4 {
  font-size: 16px;
}

.markdown-body h5 {
  font-size: 14px;
}

.markdown-body h5,
.markdown-body h6 {
  font-weight: 600;
}

.markdown-body h6 {
  font-size: 12px;
}

.markdown-body p {
  margin-top: 0;
  margin-bottom: 10px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ol,
.markdown-body ul {
  padding-left: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ol ol ol,
.markdown-body ol ul ol,
.markdown-body ul ol ol,
.markdown-body ul ul ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre {
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body input::-webkit-inner-spin-button,
.markdown-body input::-webkit-outer-spin-button {
  margin: 0;
  -webkit-appearance: none;
  appearance: none;
}

.markdown-body :checked+.radio-label {
  position: relative;
  z-index: 1;
  border-color: #0366d6;
}

.markdown-body .border {
  border: 1px solid #e1e4e8!important;
}

.markdown-body .border-0 {
  border: 0!important;
}

.markdown-body .border-bottom {
  border-bottom: 1px solid #e1e4e8!important;
}

.markdown-body .rounded-1 {
  border-radius: 3px!important;
}

.markdown-body .bg-white {
  background-color: #fff!important;
}

.markdown-body .bg-gray-light {
  background-color: #fafbfc!important;
}

.markdown-body .text-gray-light {
  color: #6a737d!important;
}

.markdown-body .mb-0 {
  margin-bottom: 0!important;
}

.markdown-body .my-2 {
  margin-top: 8px!important;
  margin-bottom: 8px!important;
}

.markdown-body .pl-0 {
  padding-left: 0!important;
}

.markdown-body .py-0 {
  padding-top: 0!important;
  padding-bottom: 0!important;
}

.markdown-body .pl-1 {
  padding-left: 4px!important;
}

.markdown-body .pl-2 {
  padding-left: 8px!important;
}

.markdown-body .py-2 {
  padding-top: 8px!important;
  padding-bottom: 8px!important;
}

.markdown-body .pl-3,
.markdown-body .px-3 {
  padding-left: 16px!important;
}

.markdown-body .px-3 {
  padding-right: 16px!important;
}

.markdown-body .pl-4 {
  padding-left: 24px!important;
}

.markdown-body .pl-5 {
  padding-left: 32px!important;
}

.markdown-body .pl-6 {
  padding-left: 40px!important;
}

.markdown-body .f6 {
  font-size: 12px!important;
}

.markdown-body .lh-condensed {
  line-height: 1.25!important;
}

.markdown-body .text-bold {
  font-weight: 600!important;
}

.markdown-body .pl-c {
  color: #6a737d;
}

.markdown-body .pl-c1,
.markdown-body .pl-s .pl-v {
  color: #005cc5;
}

.markdown-body .pl-e,
.markdown-body .pl-en {
  color: #6f42c1;
}

.markdown-body .pl-s .pl-s1,
.markdown-body .pl-smi {
  color: #24292e;
}

.markdown-body .pl-ent {
  color: #22863a;
}

.markdown-body .pl-k {
  color: #d73a49;
}

.markdown-body .pl-pds,
.markdown-body .pl-s,
.markdown-body .pl-s .pl-pse .pl-s1,
.markdown-body .pl-sr,
.markdown-body .pl-sr .pl-cce,
.markdown-body .pl-sr .pl-sra,
.markdown-body .pl-sr .pl-sre {
  color: #032f62;
}

.markdown-body .pl-smw,
.markdown-body .pl-v {
  color: #e36209;
}

.markdown-body .pl-bu {
  color: #b31d28;
}

.markdown-body .pl-ii {
  color: #fafbfc;
  background-color: #b31d28;
}

.markdown-body .pl-c2 {
  color: #fafbfc;
  background-color: #d73a49;
}

.markdown-body .pl-c2:before {
  content: "^M";
}

.markdown-body .pl-sr .pl-cce {
  font-weight: 700;
  color: #22863a;
}

.markdown-body .pl-ml {
  color: #735c0f;
}

.markdown-body .pl-mh,
.markdown-body .pl-mh .pl-en,
.markdown-body .pl-ms {
  font-weight: 700;
  color: #005cc5;
}

.markdown-body .pl-mi {
  font-style: italic;
  color: #24292e;
}

.markdown-body .pl-mb {
  font-weight: 700;
  color: #24292e;
}

.markdown-body .pl-md {
  color: #b31d28;
  background-color: #ffeef0;
}

.markdown-body .pl-mi1 {
  color: #22863a;
  background-color: #f0fff4;
}

.markdown-body .pl-mc {
  color: #e36209;
  background-color: #ffebda;
}

.markdown-body .pl-mi2 {
  color: #f6f8fa;
  background-color: #005cc5;
}

.markdown-body .pl-mdr {
  font-weight: 700;
  color: #6f42c1;
}

.markdown-body .pl-ba {
  color: #586069;
}

.markdown-body .pl-sg {
  color: #959da5;
}

.markdown-body .pl-corl {
  text-decoration: underline;
  color: #032f62;
}

.markdown-body .mb-0 {
  margin-bottom: 0!important;
}

.markdown-body .my-2 {
  margin-bottom: 8px!important;
}

.markdown-body .my-2 {
  margin-top: 8px!important;
}

.markdown-body .pl-0 {
  padding-left: 0!important;
}

.markdown-body .py-0 {
  padding-top: 0!important;
  padding-bottom: 0!important;
}

.markdown-body .pl-1 {
  padding-left: 4px!important;
}

.markdown-body .pl-2 {
  padding-left: 8px!important;
}

.markdown-body .py-2 {
  padding-top: 8px!important;
  padding-bottom: 8px!important;
}

.markdown-body .pl-3 {
  padding-left: 16px!important;
}

.markdown-body .pl-4 {
  padding-left: 24px!important;
}

.markdown-body .pl-5 {
  padding-left: 32px!important;
}

.markdown-body .pl-6 {
  padding-left: 40px!important;
}

.markdown-body .pl-7 {
  padding-left: 48px!important;
}

.markdown-body .pl-8 {
  padding-left: 64px!important;
}

.markdown-body .pl-9 {
  padding-left: 80px!important;
}

.markdown-body .pl-10 {
  padding-left: 96px!important;
}

.markdown-body .pl-11 {
  padding-left: 112px!important;
}

.markdown-body .pl-12 {
  padding-left: 128px!important;
}

.markdown-body hr {
  border-bottom-color: #eee;
}

.markdown-body kbd {
  display: inline-block;
  padding: 3px 5px;
  font: 11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
  line-height: 10px;
  color: #444d56;
  vertical-align: middle;
  background-color: #fafbfc;
  border: 1px solid #d1d5da;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #d1d5da;
}

.markdown-body:after,
.markdown-body:before {
  display: table;
  content: "";
}

.markdown-body:after {
  clear: both;
}

.markdown-body>:first-child {
  margin-top: 0!important;
}

.markdown-body>:last-child {
  margin-bottom: 0!important;
}

.markdown-body a:not([href]) {
  color: inherit;
  text-decoration: none;
}

.markdown-body blockquote,
.markdown-body details,
.markdown-body dl,
.markdown-body ol,
.markdown-body p,
.markdown-body pre,
.markdown-body table,
.markdown-body ul {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: .25em;
  padding: 0;
  margin: 24px 0;
  background-color: #e1e4e8;
  border: 0;
}

.markdown-body blockquote {
  padding: 0 1em;
  color: #6a737d;
  border-left: .25em solid #dfe2e5;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25;
}

.markdown-body h1 {
  font-size: 2em;
}

.markdown-body h1,
.markdown-body h2 {
  padding-bottom: .3em;
  border-bottom: 1px solid #eaecef;
}

.markdown-body h2 {
  font-size: 1.5em;
}

.markdown-body h3 {
  font-size: 1.25em;
}

.markdown-body h4 {
  font-size: 1em;
}

.markdown-body h5 {
  font-size: .875em;
}

.markdown-body h6 {
  font-size: .85em;
  color: #6a737d;
}

.markdown-body ol,
.markdown-body ul {
  padding-left: 2em;
}

.markdown-body ol ol,
.markdown-body ol ul,
.markdown-body ul ol,
.markdown-body ul ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li {
  word-wrap: break-all;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body li+li {
  margin-top: .25em;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: 600;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
}

.markdown-body table th {
  font-weight: 600;
}

.markdown-body table td,
.markdown-body table th {
  padding: 6px 13px;
  border: 1px solid #dfe2e5;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #c6cbd1;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

.markdown-body img {
  max-width: 100%;
  box-sizing: initial;
  background-color: #fff;
}

.markdown-body img[align=right] {
  padding-left: 20px;
}

.markdown-body img[align=left] {
  padding-right: 20px;
}

.markdown-body code {
  padding: .2em .4em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(27,31,35,.05);
  border-radius: 3px;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f6f8fa;
  border-radius: 3px;
}

.markdown-body pre code {
  display: inline;
  max-width: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  line-height: inherit;
  word-wrap: normal;
  background-color: initial;
  border: 0;
}

.markdown-body .commit-tease-sha {
  display: inline-block;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
  font-size: 90%;
  color: #444d56;
}

.markdown-body .full-commit .btn-outline:not(:disabled):hover {
  color: #005cc5;
  border-color: #005cc5;
}

.markdown-body .blob-wrapper {
  overflow-x: auto;
  overflow-y: hidden;
}

.markdown-body .blob-wrapper-embedded {
  max-height: 240px;
  overflow-y: auto;
}

.markdown-body .blob-num {
  width: 1%;
  min-width: 50px;
  padding-right: 10px;
  padding-left: 10px;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
  font-size: 12px;
  line-height: 20px;
  color: rgba(27,31,35,.3);
  text-align: right;
  white-space: nowrap;
  vertical-align: top;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.markdown-body .blob-num:hover {
  color: rgba(27,31,35,.6);
}

.markdown-body .blob-num:before {
  content: attr(data-line-number);
}

.markdown-body .blob-code {
  position: relative;
  padding-right: 10px;
  padding-left: 10px;
  line-height: 20px;
  vertical-align: top;
}

.markdown-body .blob-code-inner {
  overflow: visible;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;
  font-size: 12px;
  color: #24292e;
  word-wrap: normal;
  white-space: pre;
}

.markdown-body .pl-token.active,
.markdown-body .pl-token:hover {
  cursor: pointer;
  background: #ffea7f;
}

.markdown-body .tab-size[data-tab-size="1"] {
  -moz-tab-size: 1;
  -o-tab-size: 1;
     tab-size: 1;
}

.markdown-body .tab-size[data-tab-size="2"] {
  -moz-tab-size: 2;
  -o-tab-size: 2;
     tab-size: 2;
}

.markdown-body .tab-size[data-tab-size="3"] {
  -moz-tab-size: 3;
  -o-tab-size: 3;
     tab-size: 3;
}

.markdown-body .tab-size[data-tab-size="4"] {
  -moz-tab-size: 4;
  -o-tab-size: 4;
     tab-size: 4;
}

.markdown-body .tab-size[data-tab-size="5"] {
  -moz-tab-size: 5;
  -o-tab-size: 5;
     tab-size: 5;
}

.markdown-body .tab-size[data-tab-size="6"] {
  -moz-tab-size: 6;
  -o-tab-size: 6;
     tab-size: 6;
}

.markdown-body .tab-size[data-tab-size="7"] {
  -moz-tab-size: 7;
  -o-tab-size: 7;
     tab-size: 7;
}

.markdown-body .tab-size[data-tab-size="8"] {
  -moz-tab-size: 8;
  -o-tab-size: 8;
     tab-size: 8;
}

.markdown-body .tab-size[data-tab-size="9"] {
  -moz-tab-size: 9;
  -o-tab-size: 9;
     tab-size: 9;
}

.markdown-body .tab-size[data-tab-size="10"] {
  -moz-tab-size: 10;
  -o-tab-size: 10;
     tab-size: 10;
}

.markdown-body .tab-size[data-tab-size="11"] {
  -moz-tab-size: 11;
  -o-tab-size: 11;
     tab-size: 11;
}

.markdown-body .tab-size[data-tab-size="12"] {
  -moz-tab-size: 12;
  -o-tab-size: 12;
     tab-size: 12;
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 .2em .25em -1.6em;
  vertical-align: middle;
}
</style><style data-vue-ssr-id="64cc030e:0">.ellipsis[data-v-7ba5bd90] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.app[data-v-7ba5bd90] {
  min-width: 1024px;
}
.app .container-wrapper[data-v-7ba5bd90] {
  display: flex;
  justify-content: center;
  margin-top: 16px;
}
.app .container-wrapper .container[data-v-7ba5bd90] {
  width: 1024px;
}
@media (max-width: 500px) {
.app[data-v-7ba5bd90] {
    min-width: unset;
}
.app .container-wrapper .container[data-v-7ba5bd90] {
    width: 100%;
}
.app .back-top[data-v-7ba5bd90] {
    display: none;
}
}
</style><style data-vue-ssr-id="376aac50:0">.ellipsis[data-v-d2cca71c] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.nav-wrapper[data-v-d2cca71c] {
  display: flex;
  justify-content: center;
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
  background-color: #fff;
}
.nav-wrapper .nav[data-v-d2cca71c] {
  width: 1024px;
  height: 56px;
}
.nav-wrapper .nav .nav-actions[data-v-d2cca71c] {
  display: flex;
  height: 100%;
}
.nav-wrapper .nav .nav-actions .nav-action-link[data-v-d2cca71c] {
  margin-left: 20px;
  height: 100%;
}
.nav-wrapper .nav .nav-actions .nav-action-link[data-v-d2cca71c]:first-child {
  margin-left: 0;
}
.nav-wrapper .nav .nav-actions .nav-action-wrapper[data-v-d2cca71c] {
  display: flex;
  align-items: center;
  padding-left: 10px;
  padding-right: 10px;
  height: calc(100% - 3px);
  font-size: 14px;
  transition: color 0.3s;
}
.nav-wrapper .nav .nav-actions .nav-action-wrapper[data-v-d2cca71c]:hover {
  color: #ef4b50;
}
.nav-wrapper .nav .nav-actions .nav-action-wrapper .menu-icon[data-v-d2cca71c] {
  margin-right: 5px;
}
.nav-wrapper .nav .nav-actions .nav-action-wrapper_selected[data-v-d2cca71c] {
  position: relative;
  color: #ef4b50;
  border-bottom: 3px solid #ef4b50;
}
</style><style data-vue-ssr-id="86fe8408:0">.ellipsis[data-v-d95f0bf6] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.article-wrapper[data-v-d95f0bf6] {
  display: flex;
}
.article-wrapper .article[data-v-d95f0bf6] {
  overflow-x: hidden;
}
.article-wrapper .article .banner .banner-image[data-v-d95f0bf6] {
  width: 100%;
}
.article-wrapper .article .title[data-v-d95f0bf6] {
  margin-bottom: 0;
  margin-top: 20px;
  font-size: 30px;
  line-height: 35px;
}
.article-wrapper .article .info[data-v-d95f0bf6] {
  margin-top: 40px;
}
.article-wrapper .article .info[data-v-d95f0bf6] .info-block {
  font-size: 14px;
}
.article-wrapper .article .content[data-v-d95f0bf6] {
  margin-top: 40px;
}
.article-wrapper .article .recommend[data-v-d95f0bf6] {
  display: flex;
  margin-top: 40px;
  margin-bottom: 40px;
  font-size: 14px;
}
.article-wrapper .article .recommend .recommend-block-text[data-v-d95f0bf6] {
  margin-right: 5px;
}
.article-wrapper .article .recommend .recommend-block[data-v-d95f0bf6] {
  display: flex;
  flex-grow: 1;
  flex-shrink: 0;
}
@media (max-width: 500px) {
.article-wrapper .article .recommend .recommend-last[data-v-d95f0bf6] {
    display: none;
}
}
.article-wrapper .article .recommend .recommend-next[data-v-d95f0bf6] {
  display: flex;
  justify-content: flex-end;
}
.article-wrapper .article .footer[data-v-d95f0bf6] {
  margin-bottom: 40px;
  text-align: center;
}
.article-wrapper .article .footer .footer-button[data-v-d95f0bf6] {
  margin-left: 10px;
}
.article-wrapper .article .footer .footer-button[data-v-d95f0bf6]:first-child {
  margin-left: 0;
}
@media (max-width: 500px) {
.catalogue-wrapper[data-v-d95f0bf6] {
    display: none;
}
}
.catalogue-wrapper_toggle[data-v-d95f0bf6] {
  flex-shrink: 0;
  margin-left: 10px;
}
.catalogue-wrapper_toggle .catalogue[data-v-d95f0bf6] {
  position: sticky;
  top: 0;
}
.catalogue-wrapper_untoggle[data-v-d95f0bf6] {
  position: fixed;
  bottom: 130px;
  right: 60px;
}
</style><style data-vue-ssr-id="e6ede62e:0">.ellipsis[data-v-54a33415] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.card[data-v-54a33415] {
  padding: 24px;
  border-radius: 2px;
  box-shadow: 0px 0px 1px rgba(41, 45, 51, 0.1), 0px 1px 2px rgba(41, 45, 51, 0.1);
  box-sizing: border-box;
  background-color: #fff;
}
</style><style data-vue-ssr-id="4c88cc77:0">.ellipsis[data-v-01771278] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.info[data-v-01771278] {
  font-size: 12px;
  line-height: 18px;
  color: #666;
}
.info .info-block[data-v-01771278]::before {
  content: '|';
  margin-left: 10px;
  margin-right: 10px;
  font-weight: 600;
}
.info .info-block[data-v-01771278]:first-child::before {
  content: '';
  margin-left: 0;
  margin-right: 0;
}
</style><style data-vue-ssr-id="fec05da4:0">.ellipsis[data-v-c80b520e] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.line[data-v-c80b520e] {
  margin: 60px 8% 60px 8%;
  height: 1px;
  background-color: #d1d1d1;
}
</style><style data-vue-ssr-id="6bf8c9bc:0">.ellipsis[data-v-ce68c092] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.catalogue-card_toggle[data-v-ce68c092] {
  width: 240px;
  max-height: 100vh;
  font-size: 14px;
  line-height: 20px;
  overflow-y: auto;
}
.catalogue-card_toggle:hover .title .title-footer[data-v-ce68c092] {
  visibility: visible;
}
.catalogue-card_toggle .title[data-v-ce68c092] {
  position: relative;
  margin-bottom: 14px;
  font-weight: 500;
}
.catalogue-card_toggle .title .title-footer[data-v-ce68c092] {
  position: absolute;
  right: 0;
  top: 0;
  font-weight: 400;
  color: #ef4b50;
  visibility: hidden;
  cursor: pointer;
}
.catalogue-card_untoggle-wrapper .catalogue-card_untoggle[data-v-ce68c092] {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0;
  width: 50px;
  height: 50px;
  font-size: 20px;
  border-radius: 100%;
  transition: color 0.3s;
  cursor: pointer;
}
.catalogue-card_untoggle-wrapper .catalogue-card_untoggle[data-v-ce68c092]:hover {
  color: #ef4b50;
}
</style><style data-vue-ssr-id="2a259861:0">.ellipsis[data-v-292518fe] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.icon[data-v-292518fe] {
  width: 1em;
  height: 1em;
  vertical-align: -0.15em;
  fill: currentColor;
  overflow: hidden;
}
</style><style data-vue-ssr-id="9fa28770:0">.ellipsis[data-v-fdb56dc8] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.footer[data-v-fdb56dc8] {
  margin-top: 80px;
  padding-top: 10px;
  padding-bottom: 10px;
  text-align: center;
  font-size: 12px;
  line-height: 20px;
}
@media (max-width: 500px) {
.footer[data-v-fdb56dc8] {
    margin-top: 0;
}
}
</style><style data-vue-ssr-id="0dde9044:0">.ellipsis[data-v-876fde0e] {
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.back-top[data-v-876fde0e] {
  position: fixed;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 50px;
  height: 50px;
  font-size: 20px;
  border-radius: 100%;
  box-shadow: 0px 0px 1px rgba(41, 45, 51, 0.1), 0px 1px 2px rgba(41, 45, 51, 0.1);
  background-color: #fff;
  transition: color 0.3s;
  cursor: pointer;
}
.back-top[data-v-876fde0e]:hover {
  color: #ef4b50;
}
</style></head>
  <body>
    <div id="app" data-server-rendered="true" class="app" data-v-7ba5bd90><header class="nav-wrapper" data-v-d2cca71c data-v-7ba5bd90><div class="nav" data-v-d2cca71c><div class="nav-actions" data-v-d2cca71c><a href="/blog/" class="nav-action-link router-link-active" data-v-d2cca71c><div class="nav-action-wrapper" data-v-d2cca71c><span data-v-d2cca71c>首页</span></div></a><a href="/blog/columns" class="nav-action-link" data-v-d2cca71c><div class="nav-action-wrapper" data-v-d2cca71c><span data-v-d2cca71c>专栏</span></div></a></div></div></header><div class="container-wrapper" data-v-7ba5bd90><div class="container" data-v-7ba5bd90><div class="article-wrapper" data-v-d95f0bf6 data-v-7ba5bd90><div class="card article" data-v-54a33415 data-v-d95f0bf6><!----><h1 class="title" data-v-54a33415 data-v-d95f0bf6>ES基础</h1><div class="markdown-body content" data-v-d95f0bf6><h2 id="heading-0">一、安装</h2><p><a href="https://juejin.cn/post/6844904147557285895#heading-1">使用Docker搭建ELK环境</a></p> <pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 下载</span>
$ <span class="token function">git</span> clone https://github.com/deviantony/docker-elk.git 

<span class="token comment"># 启动，过一会儿再访问，启动较慢</span>
$ docker-compose up -d

<span class="token comment"># 重建内建用户密码，将输出的密码全部保存一下</span>
$ docker-compose <span class="token builtin class-name">exec</span> -T elasticsearch bin/elasticsearch-setup-passwords auto --batch
Changed password <span class="token keyword">for</span> user apm_system
PASSWORD apm_system <span class="token operator">=</span> YkELBJGOT6AxqsPqsi7I

Changed password <span class="token keyword">for</span> user kibana
PASSWORD kibana <span class="token operator">=</span> FxRwjm5KRYvHhGEnYTM9

Changed password <span class="token keyword">for</span> user logstash_system
PASSWORD logstash_system <span class="token operator">=</span> A4f5VOfjVWSdi0KAZWGu

Changed password <span class="token keyword">for</span> user beats_system
PASSWORD beats_system <span class="token operator">=</span> QnW8xxhnn7LMlA7vuI7B

Changed password <span class="token keyword">for</span> user remote_monitoring_user
PASSWORD remote_monitoring_user <span class="token operator">=</span> OvjEGR13wjkOkIbWqaEM

Changed password <span class="token keyword">for</span> user elastic
PASSWORD elastic <span class="token operator">=</span> PGevNMuv7PhVnaYg7vJw</code></pre><ol><li>将 <code>docker-compose.yml&gt;ELASTIC_PASSWORD</code> 置位空</li> <li>将配置文件内的<strong>elastic</strong> 密码修改为新的密码<ul><li>kibana/config/kibana.yml</li> <li>logstash/config/logstash.yml</li> <li>logstash/pipeline/logstash.conf</li></ul></li> <li>向 <code>kibana/config/kibana.yml</code>  中添加 <code>i18n.locale: &quot;zh-CN&quot;</code> 设置中文</li></ol> <pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 重启</span>
$ docker-compose restart</code></pre><p>访问kibana：localhost:5601</p> <p>使用 elastic 和 PGevNMuv7PhVnaYg7vJw 登录</p> <p>最后，可以在 kibana 中关闭付费</p> <h2 id="heading-1">二、工具使用</h2><h3 id="heading-2">1. logstash</h3><p><strong>1.安装</strong></p> <p>下载ElasticSearch对应版本的logstash后解压</p> <p><a href="https://www.elastic.co/cn/downloads/logstash">https://www.elastic.co/cn/downloads/logstash</a></p> <p><strong>2.使用</strong></p> <pre class="language-shell"><code tabindex="0" class="language-shell">$ <span class="token builtin class-name">cd</span> <span class="token variable">$logstash_path</span>
$ ./bin/logstash -f 配置文件</code></pre><p>其中，配置文件需要指向<code>csv数据文件</code>以及<code>csv数据文件的格式</code></p> <h3 id="heading-3">2. 安装分词器</h3><p>以安装ik分词器为例</p> <pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 进入容器</span>
$ docker <span class="token builtin class-name">exec</span> -it es容器id /bin/bash

<span class="token comment"># 安装wget</span>
$ yum -i <span class="token function">install</span> <span class="token function">wget</span>

<span class="token comment"># 下载ik，记得替换对应的版本号</span>
$ mdkir ik
$ <span class="token builtin class-name">cd</span> ik
$ <span class="token function">wget</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.12.1/elasticsearch-analysis-ik-7.12.1.zip
$ <span class="token function">unzip</span> elasticsearch-analysis-ik-7.12.1.zip

<span class="token comment"># 重启服务</span>
$ docker restart es容器id</code></pre><h2 id="heading-4">三、基础知识</h2><table><thead><tr><th>MySQL</th> <th>ES</th></tr></thead> <tbody><tr><td>Table 表</td> <td>Index 索引</td></tr> <tr><td>Row 行记录</td> <td>Document 记录</td></tr> <tr><td>Column 列</td> <td>Field</td></tr> <tr><td>Schema 表定义</td> <td>Mapping</td></tr> <tr><td>SQL</td> <td>DSL</td></tr></tbody></table> <h3 id="heading-5">1. 索引</h3><ul><li><p>名词</p> <p>  一个 ES 中，可以创建多个不同的索引，类似 Mysql 表</p></li> <li><p>动词</p> <p>  保存一个文档到 ES 的过程也叫索引</p></li></ul> <h3 id="heading-6">2. 文档</h3><h4 id="heading-7">2.1 概念</h4><p>类似 Mysql 表中的记录，ES是面向文档的，文档是所有可搜索数据的最小单位；</p> <p>文档会被序列化成 JSON 格式保存在 ES 中，每个字段都有对应的字符类型（字符串、数值、布尔、日期、二进制、范围类型）</p> <h4 id="heading-8">2.2 元数据</h4><p>用于标注文档的相关信息</p> <pre class="language-json"><code tabindex="0" class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"movies"</span><span class="token punctuation">,</span>
    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span>
    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">14.23223</span><span class="token punctuation">,</span>
    <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Toy Story"</span><span class="token punctuation">,</span>
        <span class="token property">"year"</span><span class="token operator">:</span> <span class="token number">1995</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><ul><li><code>_index</code>  - 文档所属的索引名</li> <li><code>_type</code>  - 文档所属的类型名</li> <li><code>_id</code>  - 文档唯一ID，可以自己指定，一般通过 ES 自动生成</li> <li><code>_source</code>  - 文档的原始 JSON 数据</li> <li><code>_version</code>  - 文档的版本信息</li> <li><code>_score</code>  - 相关性打分</li> <li><code>_all</code>  - 整合所有字段内容，已被废除</li></ul> <h3 id="heading-9">3. 倒排索引</h3><p>倒排索引包含两个部分：</p> <ul><li><p>单词词典</p> <p>  记录所有文档的单词，记录 <strong>单词</strong> 到 <strong>倒排列表</strong> 的关联关系</p> <blockquote><p>单词词典一般比较大，可以通过 B+树 或 哈希拉链法 实现，加快插入与查询</p></blockquote></li> <li><p>倒排列表</p> <p>  记录了单词对应的文档结合，包含以下内容</p> <ul><li>文档 ID</li> <li>词频 TF - 该单词在文档中出现的次数，用于相关性评分</li> <li>位置(Position) - 单词在文档中分词的位置，用于语句搜索</li> <li>偏移(Offset) - 记录单词的开始、结束位置，实现高亮显示</li></ul></li></ul> <p><strong>例子：</strong></p> <table><thead><tr><th>文档ID</th> <th>文档内容</th></tr></thead> <tbody><tr><td>1</td> <td>Mastering Elasticsearch</td></tr> <tr><td>2</td> <td>Elasticsearch Server</td></tr> <tr><td>3</td> <td>Elasticsearch Essentials</td></tr></tbody></table> <p>上面的文档会有如下的关于 <strong>Elastcisearch</strong> 的倒排列表：</p> <table><thead><tr><th>Doc Id</th> <th>TF</th> <th>Position</th> <th>Offset</th></tr></thead> <tbody><tr><td>1</td> <td>1</td> <td>1</td> <td>&lt;10,23&gt;</td></tr> <tr><td>2</td> <td>1</td> <td>0</td> <td>&lt;0,13&gt;</td></tr> <tr><td>3</td> <td>1</td> <td>0</td> <td>&lt;0,13&gt;</td></tr></tbody></table> <h3 id="heading-10">4. 分词</h3><ul><li><p>Analysis：分词，把全文本转换为一系列单词的过程</p></li> <li><p>Analyzer：分析器，按一定规则进行分词</p> <blockquote><p>除了在数据写入时使用分析器进行分词，在匹配 Query 语句时也需要用相同的分析器对查询语句进行分析</p></blockquote></li></ul> <h4 id="heading-11">4.1 分析器</h4><ol><li>Character Filters：原始文本处理，例如去除html</li> <li>Tokenizer：按照规则切分为单词</li> <li>Token Filters：将切分的单词进行加工，比如转化为小写等</li></ol> <h4 id="heading-12">4.2 ES自带分词器</h4><ul><li>Standard：默认分词器，按词切分，小写处理</li> <li>Simple：按照非字母切分（符号被过滤），小写处理</li> <li>Stop：小写处理，停用词过滤（the、a、is）</li> <li>Whitespace：安装空格切分，不转小写</li> <li>Keyword：不分词，直接将输入当做输出</li> <li>Patter：正则表达式，默认 <code>\W+</code> （非字符分割）</li> <li>Language：提供了30多种常见语言的分词器</li> <li>Customer：自定义分词器<ul><li>icu_analyzer 中文分词器</li> <li>ik，支持自定义词库，支持热更新分词字典</li> <li>THULAC，清华大学自然语言处理和社会人文计算机实验室的一套中文分词</li></ul></li></ul> <h4 id="heading-13">4.3 分词测试接口</h4><p>如果想要查看一个文本被某个分词器处理的效果，可以使用 <code>_analyze</code> 接口</p> <pre class="language-json"><code tabindex="0" class="language-json">GET /_analyze
<span class="token punctuation">{</span>
  <span class="token property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"standard"</span><span class="token punctuation">,</span>
  <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"My name is MingtaoChen"</span>
<span class="token punctuation">}</span>
# 结果如下
<span class="token punctuation">{</span>
  <span class="token property">"tokens"</span> <span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"my"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"is"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"token"</span> <span class="token operator">:</span> <span class="token string">"mingtaochen"</span><span class="token punctuation">,</span>
      <span class="token property">"start_offset"</span> <span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
      <span class="token property">"end_offset"</span> <span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"&lt;ALPHANUM>"</span><span class="token punctuation">,</span>
      <span class="token property">"position"</span> <span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><p>可以使用自定义分析器</p> <pre class="language-shell"><code tabindex="0" class="language-shell">$ GET /_analyze
<span class="token punctuation">{</span>
  <span class="token string">"tokenizer"</span><span class="token builtin class-name">:</span> <span class="token string">"standard"</span>,
  <span class="token string">"filter"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"lowercase"</span><span class="token punctuation">]</span>,
  <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"My name is MingtaoChen"</span>
<span class="token punctuation">}</span></code></pre><p>也可以使用指定索引字段的分析器进行测试</p> <pre class="language-shell"><code tabindex="0" class="language-shell">$ GET user/_analyze
<span class="token punctuation">{</span>
  <span class="token string">"field"</span><span class="token builtin class-name">:</span> <span class="token string">"name"</span>,
  <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"My name is MingtaoChen"</span>
<span class="token punctuation">}</span></code></pre><h3 id="heading-14">5. Mapping</h3><p>Mapping是对索引的结构定义，类似 Mysql 表结构定义</p> <p>查看某个索引的Mapping</p> <p><code>GET user/_mapping</code></p> <h4 id="heading-15">5.1 字段数据类型</h4><ul><li>简单类型<ul><li>Text / Keyword</li> <li>Date</li> <li>Integer / Floating</li> <li>Boolean</li> <li>IPv4 &amp; IPv6</li></ul></li> <li>复杂类型 - 对象和嵌套对象<ul><li>对象类型 / 嵌套类型</li></ul></li> <li>特殊类型<ul><li>geo_point &amp; geo_shape / percolator</li></ul></li></ul> <h4 id="heading-16">5.2 Dynamic Mapping</h4><p>在写入文档时，如果索引不存在会自动创建索引并定义Mapping，ES 会自动根据文档信息，推算出字段的类型，但是有时候会推算错误，例如地理位置信息等</p> <p><strong>配置Dynamic</strong></p> <pre class="language-shell"><code tabindex="0" class="language-shell">PUT user
<span class="token punctuation">{</span>
    <span class="token string">"mappings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"_doc"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">"dynamic"</span><span class="token builtin class-name">:</span> <span class="token string">"false"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p><strong>dynamic不同设置，插入新文档有新增的字段时影响如下：</strong></p> <table><thead><tr><th></th> <th>true</th> <th>false</th> <th>strict</th></tr></thead> <tbody><tr><td>文档可索引</td> <td>y</td> <td>y</td> <td>n</td></tr> <tr><td>字段可索引</td> <td>y</td> <td>n</td> <td>n</td></tr> <tr><td>Mapping被更新</td> <td>y</td> <td>n</td> <td>n</td></tr></tbody></table> <ul><li>false 情况下，Mapping不会更新，但是数据插入成功</li> <li>strict 情况下，直接报错</li></ul> <blockquote><p><strong>使用动态mapping的隐患</strong></p> <ul><li>设置成strict，万一有一条数据里带着不存在的字段，写入就会失败</li> <li>设置成true，数据可以写入，还会在mapping中增加那个字段的设置。随着时间的流逝，这类数据会导致mapping设定的膨胀</li></ul></blockquote> <h4 id="heading-17">5.3 定义Mapping</h4><p>为减少输入的工作量和出错概率，可以依照一下步骤：</p> <ol><li><p>使用一些样本数据创建一个临时的 index</p> <pre class="language-json"><code tabindex="0" class="language-json">POST /user_demo/_doc
<span class="token punctuation">{</span>
  <span class="token property">"app_id"</span><span class="token operator">:</span> <span class="token string">"appsldfms"</span><span class="token punctuation">,</span>
  <span class="token property">"community_id"</span><span class="token operator">:</span> <span class="token string">"c_5basf9e685_aksdfmlsmf32e"</span><span class="token punctuation">,</span>
  <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token string">"u_5basdfdsf_asd9wDz3e8"</span><span class="token punctuation">,</span>
  <span class="token property">"nick_name"</span><span class="token operator">:</span> <span class="token string">"不会扎头的小丸子"</span><span class="token punctuation">,</span>
  <span class="token property">"wx_avatar"</span><span class="token operator">:</span> <span class="token string">"https://www.baidu.com"</span><span class="token punctuation">,</span>
  <span class="token property">"wx_unionid"</span><span class="token operator">:</span> <span class="token string">"aosdjf"</span><span class="token punctuation">,</span>
  <span class="token property">"state"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"is_quit"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2018-10-11 09:27:11"</span><span class="token punctuation">,</span>
  <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2021-06-05 06:03:56"</span><span class="token punctuation">,</span>
  <span class="token property">"need_notify"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"subscribe_from"</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span></code></pre></li> <li><p>获取该 index 的动态 Mapping 定义</p> <pre class="language-json"><code tabindex="0" class="language-json">GET /user_demo/_mapping</code></pre></li> <li><p>根据需求对该 Mapping 进行修改，使用新的 Mapping 配置创建索引</p> <pre class="language-json"><code tabindex="0" class="language-json">PUT /user
<span class="token punctuation">{</span>
  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"properties"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"app_id"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"community_id"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"created_at"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"date"</span><span class="token punctuation">,</span>
        <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"is_quit"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"need_notify"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"nick_name"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"index_options"</span><span class="token operator">:</span> <span class="token string">"offsets"</span><span class="token punctuation">,</span>
        <span class="token property">"fields"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"keyword"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span>
            <span class="token property">"ignore_above"</span> <span class="token operator">:</span> <span class="token number">256</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"state"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"subscribe_from"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"long"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"updated_at"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"date"</span><span class="token punctuation">,</span>
        <span class="token property">"format"</span><span class="token operator">:</span> <span class="token string">"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"user_id"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"wx_avatar"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"wx_unionid"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"type"</span> <span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></li> <li><p>删除临时索引</p> <pre class="language-shell"><code tabindex="0" class="language-shell">DELETE /user_demo</code></pre></li></ol> <blockquote><ul><li><p>index：控制字段是否被索引</p></li> <li><p>index_options：控制倒排索引记录的内容</p> <ul><li>docs：记录 doc id</li> <li>freqs：记录 doc id 和 term frequencies</li> <li>position：记录 doc id、term frequencies、term position</li> <li>offsets：doc id、term frequencies、term position、character offects</li></ul></li></ul> <p>text类型默认记录 positions，其他默认为 docs，记录内容越多，占用存储空间越大</p></blockquote> <h2 id="heading-18">四、集群</h2><h3 id="heading-19">1. 节点</h3><ul><li>节点是一个 ES 实例，本质上就是一个Java进程，一台机器可以运行多个 ES 实例，但是生产环境一般建议一台机器值运行一个 ES 实例</li> <li>每个节点都有名字，通过配置文件配置，或者启动时 <code>-E node.name=nodeName</code> 指定</li> <li>每个节点启动之后，会分配一个 UID，保存在 data 目录下</li></ul> <h4 id="heading-20">1.1 Master-eligible Node</h4><blockquote><p>Master node  主节点，可以有多个 Master 节点，但是只能有一个active</p> <p>Master-eligible nodes  可以参加选主流程成为 Master 的节点</p></blockquote> <ul><li><strong>第一个启动</strong>的节点会将自己选举成 Master 节点，其他节点启动后默认就是 Master eligible 节点，可以设置 <code>node.master: false</code> 禁止，禁止的节点将不会参加选主流程</li> <li>每个节点上都保存了集群的状态，<strong>只有 Master 节点才能修改集群的状态信息</strong></li> <li>集群信息（Cluster State）维护了一个集群中必要的信息：<ul><li>所有的节点信息</li> <li>所有的索引和其相关的 Mapping 与 Setting 信息</li> <li>分片的路由信息</li></ul></li></ul> <h4 id="heading-21">1.2 Data Node</h4><p>可以保存数据的节点，叫做 Data Node。负责保存分片数据，在数据扩展上起到了至关重要的作用</p> <h4 id="heading-22">1.3 Coordinating Node</h4><ul><li>负责接收 Client 的请求，将请求分发到合适的节点，最终把结果汇集到一起</li> <li>每个节点默认都起到了 Coordinating Node 的职责</li></ul> <h4 id="heading-23">1.4 Hot &amp; Warm Node</h4><p>不同硬件配置的 Data Node，用来实现 Hot &amp; Warm 架构，降低集群部署的成本</p> <h4 id="heading-24">1.5 Machine Learning Node</h4><p>负责跑机器学习的任务，用来做异常检测</p> <h4 id="heading-25">总结</h4><p>开发环境中一个可以承担多种角色，但生产环境中，应该设置节点单一的角色</p> <p>节点相关配置参数如下：</p> <table><thead><tr><th>节点类型</th> <th>配置参数</th> <th>默认值</th></tr></thead> <tbody><tr><td>Master-eligible</td> <td>node.master</td> <td>true</td></tr> <tr><td>data</td> <td>node.data</td> <td>true</td></tr> <tr><td>ingest</td> <td>node.ingest</td> <td>true</td></tr> <tr><td>coordinating only</td> <td>无</td> <td>每个节点默认都是(设置其他类型都为false)</td></tr> <tr><td>macheine learning</td> <td>node.ml</td> <td>true(需enable x-pack)</td></tr></tbody></table> <h3 id="heading-26">2. 分片</h3><ul><li><p>主分片（Primary Shard）</p> <p>  主分片可以将数据分布到集群内的所有节点上，一个分片是一个运行的 Lucene 实例，解决数据水平扩展的问题。<strong>主分片数量在索引创建时指定，后续不允许修改，除非重建索引。</strong></p></li> <li><p>副本（Replica Shard）</p> <p>  是主分片的拷贝，数量可以动态地调整，增加副本数在一定程度上提高服务的可用性、读取的吞吐</p></li></ul> <h4 id="heading-27">分片数设置</h4><ul><li>设置数量过少<ul><li>可能导致后续增加节点后分片少于节点数，将无法实现水平扩展</li> <li>单个分片的数据量太大，导致数据重新分配耗时</li></ul></li> <li>设置数量过多<ul><li>单个节点过多的分片，会导致资源浪费，同时影响性能</li> <li>影响搜索结果的相关性打分，影响统计结果的准确性</li></ul></li></ul> <p><strong>从7.0开始，默认主分片数为1</strong></p> <h3 id="heading-28">3. 获取集群健康状态</h3><pre class="language-json"><code tabindex="0" class="language-json">GET _cluster/health
<span class="token punctuation">{</span>
  <span class="token property">"cluster_name"</span> <span class="token operator">:</span> <span class="token string">"docker-cluster"</span><span class="token punctuation">,</span>
  <span class="token property">"status"</span> <span class="token operator">:</span> <span class="token string">"yellow"</span><span class="token punctuation">,</span>
  <span class="token property">"timed_out"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"number_of_nodes"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"number_of_data_nodes"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"active_primary_shards"</span> <span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
  <span class="token property">"active_shards"</span> <span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
  <span class="token property">"relocating_shards"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"initializing_shards"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"unassigned_shards"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token property">"delayed_unassigned_shards"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"number_of_pending_tasks"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"number_of_in_flight_fetch"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"task_max_waiting_in_queue_millis"</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"active_shards_percent_as_number"</span> <span class="token operator">:</span> <span class="token number">93.10344827586206</span>
<span class="token punctuation">}</span></code></pre><ul><li>status<ul><li>green 主分片与副本都正常分配</li> <li>yellow 主分片正常分配，有副本分配未能正常分配</li> <li>red 有主分片未能分配，例如当服务器的磁盘容量超过85%时去创建了一个新的索引</li></ul></li> <li><code>active_primary_shards</code> 集群中的主分片数量，涵盖了所有索引的汇总值</li> <li><code>active_shards</code> 集群中的分片数量，涵盖了所有索引的汇总值</li> <li><code>relocating_shards</code> 显示当前正在从一个节点迁往其他节点的分片的数量。通常来说应该是 0，不过在 Elasticsearch 发现集群不太均衡时，该值会上涨。比如说：添加了一个新节点，或者下线了一个节点。</li> <li><code>initializing_shards</code> 是刚刚创建的分片的个数。比如，当你刚创建第一个索引，分片都会短暂的处于 <code>initializing</code> 状态。这通常会是一个临时事件，分片不应该长期停留在 <code>initializing</code> 状态。你还可能在节点刚重启的时候看到 <code>initializing</code> 分片：当分片从磁盘上加载后，它们会从 <code>initializing</code> 状态开始。</li> <li><code>unassigned_shards</code> 是已经在集群状态中存在的分片，但是实际在集群里又找不着。通常未分配分片的来源是未分配的副本。比如，一个有 5 分片和 1 副本的索引，在单节点集群上，就会有 5 个未分配副本分片。如果你的集群是 <code>red</code> 状态，也会长期保有未分配分片（因为缺少主分片）</li></ul> <h2 id="heading-29">五、基础操作</h2><h3 id="heading-30">1. 索引</h3><pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 新建索引</span>
$ PUT user

<span class="token comment"># 删除索引</span>
$ DELETE user

<span class="token comment"># 查看所有索引信息</span>
$ GET /_cat/indices?v</code></pre><h3 id="heading-31">2. 文档</h3><h4 id="heading-32">2.1 创建</h4><pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 使用 PUT 幂等性，需指定id</span>
$ PUT /users/_doc/1 
<span class="token punctuation">{</span>
  <span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"wsj"</span>,
  <span class="token string">"age"</span>:20
<span class="token punctuation">}</span>

$ POST /users/_doc
<span class="token punctuation">{</span>
  <span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"wsj2"</span>,
  <span class="token string">"age"</span>:21
<span class="token punctuation">}</span></code></pre><h4 id="heading-33">2.2 删除</h4><pre class="language-shell"><code tabindex="0" class="language-shell">$ DELETE /users/_doc/1</code></pre><h4 id="heading-34">2.3 更新</h4><pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 更新,可以增加字段，也可以更新原来字段的值</span>
$ POST users/_update/2
<span class="token punctuation">{</span>
    <span class="token string">"doc"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"wsj3"</span>,
        <span class="token string">"age"</span>:23,
        <span class="token string">"gender"</span><span class="token builtin class-name">:</span><span class="token string">"male"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h4 id="heading-35">2.4 查询</h4><pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 查询id为1的文档</span>
$ GET /users/_doc/1

<span class="token comment"># 只查询部分字段，用逗号隔开</span>
$ GET /users/_doc/1?_source<span class="token operator">=</span>name,gender

<span class="token comment"># 当字段较多时，可以选择包括和排除字段</span>
$ GET /users/_doc/1?_source_includes<span class="token operator">=</span>name<span class="token operator">&amp;</span><span class="token assign-left variable">_souce_excludes</span><span class="token operator">=</span>age

<span class="token comment"># 如果只想得到 _source 字段，不需要任何元数据，使用 _source 端点</span>
$ GET /users/_doc/1/_source

</code></pre><h4 id="heading-36">2.5 mget</h4><pre class="language-shell"><code tabindex="0" class="language-shell">$ GET _mget
<span class="token punctuation">{</span>
  <span class="token string">"docs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">"_index"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,
      <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>,
    <span class="token punctuation">{</span>
      <span class="token string">"_index"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,
      <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre><h4 id="heading-37">2.6 bulk</h4><p>与 <code>mget</code> 可以使我们一次取回多个文档同样的方式， <code>bulk</code> API 允许在单个步骤中进行多次 <code>create</code> 、 <code>index</code> 、 <code>update</code> 或 <code>delete</code> 请求，多条操作中的单条操作失败并不会影响其他操作</p> <pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token punctuation">{</span> action: <span class="token punctuation">{</span> metadata <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> request body        <span class="token punctuation">}</span>
<span class="token punctuation">{</span> action: <span class="token punctuation">{</span> metadata <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> request body        <span class="token punctuation">}</span>
<span class="token punctuation">..</span>.</code></pre><p>例如：</p> <pre class="language-shell"><code tabindex="0" class="language-shell">POST /_bulk
<span class="token punctuation">{</span> <span class="token string">"delete"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">"_index"</span><span class="token builtin class-name">:</span> <span class="token string">"website"</span>, <span class="token string">"_type"</span><span class="token builtin class-name">:</span> <span class="token string">"blog"</span>, <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> 
<span class="token punctuation">{</span> <span class="token string">"create"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">"_index"</span><span class="token builtin class-name">:</span> <span class="token string">"website"</span>, <span class="token string">"_type"</span><span class="token builtin class-name">:</span> <span class="token string">"blog"</span>, <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"title"</span><span class="token builtin class-name">:</span>    <span class="token string">"My first blog post"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"index"</span><span class="token builtin class-name">:</span>  <span class="token punctuation">{</span> <span class="token string">"_index"</span><span class="token builtin class-name">:</span> <span class="token string">"website"</span>, <span class="token string">"_type"</span><span class="token builtin class-name">:</span> <span class="token string">"blog"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"title"</span><span class="token builtin class-name">:</span>    <span class="token string">"My second blog post"</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"update"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span> <span class="token string">"_index"</span><span class="token builtin class-name">:</span> <span class="token string">"website"</span>, <span class="token string">"_type"</span><span class="token builtin class-name">:</span> <span class="token string">"blog"</span>, <span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token string">"123"</span>, <span class="token string">"_retry_on_conflict"</span> <span class="token builtin class-name">:</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">"doc"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"title"</span> <span class="token builtin class-name">:</span> <span class="token string">"My updated blog post"</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> </code></pre><ul><li><p>请注意 <code>delete</code> 动作不能有请求体,它后面跟着的是另外一个操作</p></li> <li><p>谨记最后一个换行符不要落下</p></li> <li><p>不要一次请求操作过多</p> <blockquote><p>整个批量请求都需要由接收到请求的节点加载到内存中，因此该请求越大，其他请求所能获得的内存就越少。 批量请求的大小有一个最佳值，大于这个值，性能将不再提升，甚至会下降。 但是最佳值不是一个固定的值。它完全取决于硬件、文档的大小和复杂度、索引和搜索的负载的整体情况。</p> <p>幸运的是，很容易找到这个 <em>最佳点</em> ：通过批量索引典型文档，并不断增加批量大小进行尝试。 当性能开始下降，那么你的批量大小就太大了。一个好的办法是开始时将 1,000 到 5,000 个文档作为一个批次, 如果你的文档非常大，那么就减少批量的文档个数。</p> <p>密切关注你的批量请求的物理大小往往非常有用，一千个 1KB 的文档是完全不同于一千个 1MB 文档所占的物理大小。 一个好的批量大小在开始处理后所占用的物理大小约为 5-15 MB</p></blockquote></li></ul> <h2 id="heading-38">六、搜索</h2><ul><li>url查询</li> <li>Query DSL查询(建议)</li></ul> <h3 id="heading-39">1. 索引</h3><pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 单个索引</span>
GET /movies/_search
<span class="token punctuation">{</span>
  <span class="token string">"profile"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>,    <span class="token comment"># 显示es如何搜索的</span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment"># 多个个索引</span>
GET /movies,user/_search
<span class="token punctuation">{</span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="heading-40">2. query语法</h3><h4 id="heading-41">2.1 Query String</h4><pre class="language-shell"><code tabindex="0" class="language-shell">GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"profile"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>, 
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"default_field"</span><span class="token builtin class-name">:</span> <span class="token string">"name"</span>, 
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"!mittacy chen"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>支持 AND、OR、NOT、&amp;&amp;、||、!</p> <pre class="language-shell"><code tabindex="0" class="language-shell">GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"profile"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>, 
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span>, <span class="token string">"about"</span><span class="token punctuation">]</span>, 
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"(Ruan AND Yiming) OR (Java AND Elasticsearch)"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h4 id="heading-42">2.2 Simple Query String</h4><pre class="language-shell"><code tabindex="0" class="language-shell">GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"profile"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>, 
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"simple_query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"mittacy chen"</span>,
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>,
      <span class="token string">"default_operator"</span><span class="token builtin class-name">:</span> <span class="token string">"AND"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>只支持 + / - / |，不支持 AND / NOT / OR，各个词之间的关系默认为 或，可以指定Operator</p> <pre class="language-shell"><code tabindex="0" class="language-shell">GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"profile"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>, 
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"simple_query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"-mittacy +chen"</span>,
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h4 id="heading-43">2.2 短语搜索</h4><pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 查询包含 "mittacy chen"，要求中间不能有其他字符</span>
GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_phrase"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"mittacy chen"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 查询包含 "mittacy chen"，中间可以有其他字符</span>
GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_phrase"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"mittacy chen"</span>,
      <span class="token string">"slop"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><pre class="language-shell"><code tabindex="0" class="language-shell"><span class="token comment"># 搜索名字包含chen的文档</span>
GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"chen"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># 搜索名字包含chen不包含mittacy的文档</span>
GET /user/_search
<span class="token punctuation">{</span>
  <span class="token string">"profile"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>,
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"bool"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"must"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"chen"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">"must_not"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"mittacy"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="heading-44">3. 分页</h3><pre class="language-shell"><code tabindex="0" class="language-shell">GET /movies/_search
<span class="token punctuation">{</span>
  <span class="token string">"from"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">"size"</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>越往后的翻页成本越高</p> <h3 id="heading-45">4 选择指定字段</h3><pre class="language-shell"><code tabindex="0" class="language-shell">GET /movies/_search
<span class="token punctuation">{</span>
  <span class="token string">"_source"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"order_date"</span>, <span class="token string">"_id"</span><span class="token punctuation">]</span>,
  <span class="token string">"from"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">"size"</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="heading-46">5. 排序</h3><pre class="language-shell"><code tabindex="0" class="language-shell">GET /movies/_search
<span class="token punctuation">{</span>
  <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span><span class="token string">"order_date"</span><span class="token builtin class-name">:</span> <span class="token string">"desc"</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"from"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">"size"</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>最好在 “数字型” 或 “日期型” 字段上排序，因为对于多值类型或分析过的字段排序，系统会选一个值，无法得知该值</p> <h3 id="heading-47">6. 脚本字段</h3><p>对旧字段进行操作生成新字段名并进行排序返回</p> <p>比如订单中有不同的汇率，需要结合汇率对订单价格进行操作后再进行排序</p> <pre class="language-shell"><code tabindex="0" class="language-shell">GET user/_search
<span class="token punctuation">{</span>
  <span class="token string">"script_fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"new_FIELD"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">"script"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>, 
<span class="token punctuation">}</span></code></pre></div><div class="info info" data-v-01771278 data-v-d95f0bf6><span class="info-block" data-v-01771278>发布于: 2021/4/8</span><span class="info-block" data-v-01771278>类别: <a href="/blog/?category=ElasticSearch" data-v-01771278>ElasticSearch</a></span></div><div class="recommend" data-v-54a33415 data-v-d95f0bf6><div class="recommend-block recommend-last" data-v-54a33415 data-v-d95f0bf6><a href="/blog/article/1630739392756" data-v-d95f0bf6><span class="recommend-block-text" data-v-d95f0bf6>上一篇: </span><span data-v-d95f0bf6>Mac重装系统</span></a></div><div class="recommend-block recommend-next" data-v-54a33415 data-v-d95f0bf6><a href="/blog/article/1633509976301" data-v-d95f0bf6><span class="recommend-block-text" data-v-d95f0bf6>下一篇: </span><span data-v-d95f0bf6>Docker 博客后端部署过程</span></a></div></div><div class="line" data-v-c80b520e data-v-d95f0bf6></div></div><div class="catalogue-wrapper catalogue-wrapper_untoggle" data-v-d95f0bf6><div class="catalogue-card_untoggle-wrapper catalogue" data-v-ce68c092 data-v-d95f0bf6><div class="card catalogue-card_untoggle" data-v-54a33415 data-v-ce68c092><svg aria-hidden="true" class="icon" data-v-292518fe data-v-ce68c092><use xlink:href="#icon-catalogue" data-v-292518fe></use></svg></div></div></div></div></div></div><div class="footer" data-v-fdb56dc8 data-v-7ba5bd90><section class="footer-section" data-v-fdb56dc8>©2022 Mittacy's Blog. All rights reserved</section><section class="footer-section" data-v-fdb56dc8><a href="https://beian.miit.gov.cn" target="_blank" rel="noopener noreferrer" data-v-fdb56dc8>备案号: 粤ICP备2021130319号-1</a></section></div><div class="back-top back-top" style="bottom:60px;right:60px;" data-v-876fde0e data-v-7ba5bd90><svg aria-hidden="true" class="icon" data-v-292518fe data-v-876fde0e><use xlink:href="#icon-rocket" data-v-292518fe></use></svg></div></div><script src="/blog/static/js/chunk-vendors.98aa2d5e.js" defer></script><script src="/blog/static/js/chunk-4b00a56a.f60616c1.js" defer></script><script src="/blog/static/js/chunk-d54686c8.5143f685.js" defer></script><script src="/blog/static/js/app.0d2651de.js" defer></script>
    <script src="//at.alicdn.com/t/font_2712780_iw7teim8vh.js"></script>
    
  </body>
</html>
